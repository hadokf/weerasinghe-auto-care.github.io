<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weerasinghe Enterprise | Advanced Auto Engineering</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        :root { --neon: #00f3ff; --dark: #050505; --panel: #111; --orange: #ff3c00; }
        body { background-color: var(--dark); color: white; font-family: 'Rajdhani', sans-serif; overflow-x: hidden; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        .glass-nav { background: rgba(5, 5, 5, 0.8); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        
        .hex-card {
            background: #0f0f11;
            clip-path: polygon(10% 0, 100% 0, 100% 90%, 90% 100%, 0 100%, 0 10%);
            border-left: 3px solid var(--neon);
            transition: all 0.4s ease-out;
            position: relative;
            overflow: hidden;
        }
        .service-hex:hover { transform: translateY(-8px); border-left-color: var(--orange); background: #16161a; box-shadow: 0 10px 30px -10px rgba(255, 60, 0, 0.3); }
        .news-hex:hover { transform: translateY(-8px); border-left-color: var(--neon); }
        .news-hex:hover img { transform: scale(1.1); opacity: 1; }
        .news-hex:hover h3 { color: var(--neon); }

        .glow-text { text-shadow: 0 0 30px rgba(0, 243, 255, 0.5); }
        .bg-hero { background-image: url('https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?q=80&w=1932&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'); }
    </style>
</head>
<body>

    <nav class="fixed w-full z-50 glass-nav py-4 px-6 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-gear text-[#00f3ff] text-3xl fa-spin" style="--fa-animation-duration: 5s;"></i>
            <div class="leading-none">
                <h1 class="font-orbitron font-bold text-xl tracking-wider text-white">WEERASINGHE</h1>
                <p class="text-[10px] text-[#00f3ff] tracking-[0.3em] uppercase font-bold">Enterprise</p>
            </div>
        </div>
        <div class="hidden md:flex gap-8 text-xs font-bold uppercase tracking-widest text-gray-400">
            <a href="#track" class="text-white hover:text-[#00f3ff] transition">Track Vehicle</a>
            <a href="#services" class="hover:text-white transition">Services</a>
            <a href="#news" class="hover:text-white transition">News</a>
            <a href="#booking" class="hover:text-white transition">Booking</a>
            <a href="#contact" class="hover:text-white transition">Contact</a>
        </div>
    </nav>

    <section class="relative min-h-screen flex items-center justify-center pt-20 overflow-hidden px-4 bg-hero bg-cover bg-center bg-fixed">
        <div class="absolute inset-0 bg-black/80"></div>
        <div class="absolute inset-0 opacity-10 z-10" style="background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 40px 40px;"></div>
        
        <div class="text-center z-20 max-w-5xl mx-auto">
            <div class="inline-flex items-center gap-2 px-4 py-2 mb-8 border border-[#00f3ff]/30 rounded-full bg-black/50 backdrop-blur-md text-[#00f3ff] text-xs font-bold tracking-widest animate-pulse">
                <i class="fa-solid fa-screwdriver-wrench"></i> EST. 1996 • KANDY & KEGALLE
            </div>
            <h1 class="text-5xl md:text-8xl font-orbitron font-black leading-tight mb-6 glow-text">
                AUTOMOTIVE <br> <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#00f3ff] via-blue-500 to-purple-600">MASTERY</span>
            </h1>
            <p class="text-gray-300 text-lg mb-10 max-w-2xl mx-auto leading-relaxed font-medium">
                Sri Lanka's trusted leader in Hybrid, EV, and complex engine diagnostics. Combining decades of experience with cutting-edge technology.
            </p>
            <div class="flex flex-col md:flex-row gap-5 justify-center">
                <a href="#track" class="bg-[#00f3ff] text-black font-bold px-8 py-4 rounded hover:bg-white transition uppercase tracking-widest shadow-[0_0_30px_rgba(0,243,255,0.4)] hover:shadow-[0_0_50px_rgba(255,255,255,0.6)]">
                    <i class="fa-solid fa-magnifying-glass mr-2"></i> Track Your Repair
                </a>
                <a href="#booking" class="border-2 border-gray-600 text-white font-bold px-8 py-4 rounded hover:border-[#00f3ff] hover:text-[#00f3ff] transition uppercase tracking-widest backdrop-blur-sm bg-black/30">
                    Book Service
                </a>
            </div>
        </div>
    </section>

    <section id="track" class="py-24 bg-[#0a0a0c] border-y border-gray-900/50 relative">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-[#00f3ff]/5 to-transparent opacity-30 pointer-events-none"></div>
        <div class="container mx-auto px-6 max-w-4xl relative z-10">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-orbitron font-bold mb-3">LIVE STATUS <span class="text-[#00f3ff]">TRACKER</span></h2>
                <p class="text-gray-400 text-sm tracking-wider">Enter your vehicle number to view real-time service progress.</p>
            </div>

            <div class="relative flex bg-[#111] border-2 border-gray-700 rounded-xl p-2 max-w-md mx-auto mb-16 shadow-[0_0_40px_rgba(0,243,255,0.15)] group focus-within:border-[#00f3ff] transition-all">
                <input type="text" id="vehicle-input" placeholder="WP ABC-1234" class="w-full bg-transparent text-white p-4 font-bold uppercase focus:outline-none text-center tracking-[0.2em] text-xl placeholder:text-gray-600 placeholder:tracking-normal placeholder:font-medium">
                <button onclick="checkHistory()" class="absolute right-2 top-2 bottom-2 bg-gradient-to-r from-blue-600 to-[#00f3ff] text-black px-6 rounded-lg font-bold hover:opacity-90 transition">
                    <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>

            <div id="result-area" class="hidden">
                <div id="report-card" class="bg-white text-black p-8 rounded-xl relative overflow-hidden shadow-2xl border-t-4 border-blue-600">
                    
                    <div class="flex justify-between items-start border-b-2 border-black pb-6 mb-6">
                        <div>
                            <h2 class="text-3xl font-bold font-orbitron tracking-tight">WEERASINGHE AUTO</h2>
                            <p class="text-xs font-bold text-gray-600 uppercase tracking-widest mt-1">Kegalle & Kandy | Hotline: 077-XXXXXXX</p>
                        </div>
                        <div class="text-center bg-gray-100 p-2 rounded-lg">
                            <div id="qr-code" class="flex items-center justify-center bg-white p-1"></div>
                            <p class="text-[8px] font-bold uppercase mt-1 tracking-widest text-gray-500">Scan for History</p>
                        </div>
                    </div>

                    <div class="bg-gray-100 p-6 rounded-lg mb-8 grid grid-cols-2 gap-4 shadow-inner relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                        <div>
                            <p class="text-[10px] uppercase font-black text-gray-400 tracking-widest mb-1">Vehicle No</p>
                            <h3 id="r-vno" class="text-3xl font-black text-blue-900 uppercase tracking-wider font-orbitron">WP XXX-0000</h3>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] uppercase font-black text-gray-400 tracking-widest mb-1">Owner</p>
                            <h3 id="r-owner" class="text-xl font-bold text-gray-800">Customer Name</h3>
                        </div>
                    </div>

                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 id="r-service" class="text-2xl font-bold text-black">Full Service</h3>
                            <span id="r-status" class="bg-yellow-400 text-black px-4 py-2 text-sm font-black rounded-lg shadow-sm transform -rotate-2 border-2 border-black">PENDING</span>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                            <p class="text-xs font-bold text-blue-500 uppercase mb-2">Mechanic Notes:</p>
                            <p id="r-notes" class="text-sm italic text-gray-700">Notes will appear here...</p>
                        </div>
                        <p id="r-date" class="text-xs text-right font-bold text-gray-400 mt-4">Last Updated: 2026-01-30</p>
                    </div>

                    <div class="border-t-2 border-dashed border-gray-300 pt-6">
                        <h4 class="text-xs font-bold uppercase text-gray-500 mb-4 tracking-widest">Previous Service History</h4>
                        <div id="history-list" class="space-y-3 text-sm">
                            </div>
                    </div>
                </div>

                <div class="flex justify-center gap-4 mt-8">
                    <button onclick="downloadPDF()" class="bg-red-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-red-700 flex items-center gap-3 shadow-lg hover:shadow-red-600/30 transition">
                        <i class="fa-solid fa-file-pdf text-xl"></i> Download Official Report
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section id="services" class="py-24 px-6 relative overflow-hidden">
        <i class="fa-solid fa-gears absolute top-20 -left-20 text-[15rem] text-gray-800 opacity-20 fa-spin" style="--fa-animation-duration: 60s;"></i>
        <div class="container mx-auto relative z-10">
            <h2 class="text-4xl md:text-5xl font-orbitron font-bold mb-16 text-center">OUR <span class="text-[#00f3ff]">EXPERTISE</span></h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="hex-card service-hex p-8 group">
                    <i class="fa-solid fa-car-battery text-5xl text-gray-600 group-hover:text-[#ff3c00] mb-6 transition-colors duration-300"></i>
                    <h3 class="text-2xl font-bold font-orbitron mb-3 group-hover:text-white transition">HYBRID & EV</h3>
                    <p class="text-gray-400 text-sm leading-relaxed group-hover:text-gray-300">Specialized health analysis, cell balancing, and inverter repair.</p>
                </div>
                <div class="hex-card service-hex p-8 group">
                    <i class="fa-solid fa-microchip text-5xl text-gray-600 group-hover:text-[#ff3c00] mb-6 transition-colors duration-300"></i>
                    <h3 class="text-2xl font-bold font-orbitron mb-3 group-hover:text-white transition">ADVANCED DIAGNOSTICS</h3>
                    <p class="text-gray-400 text-sm leading-relaxed group-hover:text-gray-300">Dealer-level OBD-II scanning, sensor calibration, ECU remapping.</p>
                </div>
                <div class="hex-card service-hex p-8 group">
                    <i class="fa-solid fa-pistons text-5xl text-gray-600 group-hover:text-[#ff3c00] mb-6 transition-colors duration-300"></i>
                    <h3 class="text-2xl font-bold font-orbitron mb-3 group-hover:text-white transition">PRECISION ENGINE</h3>
                    <p class="text-gray-400 text-sm leading-relaxed group-hover:text-gray-300">Complete overhauls with micrometer precision and performance tuning.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="booking" class="py-24 relative border-t border-gray-800 overflow-hidden">
        <div class="absolute inset-0 bg-[#00f3ff]/5 bg-[radial-gradient(ellipse_at_bottom,_var(--tw-gradient-stops))] from-blue-900/30 via-transparent to-transparent"></div>
        <div class="container mx-auto px-6 grid md:grid-cols-2 gap-16 items-center relative z-10">
            <div>
                <h2 class="text-4xl font-orbitron font-bold mb-6 leading-tight">BOOK YOUR <br><span class="text-[#00f3ff]">APPOINTMENT</span></h2>
                <p class="text-gray-400 mb-8 text-lg font-medium">Skip the queue. Submit your details here.</p>
            </div>
            <div class="bg-[#111]/80 backdrop-blur-xl p-8 border-2 border-[#00f3ff]/30 rounded-2xl shadow-[0_0_50px_rgba(0,243,255,0.1)]">
                <div class="space-y-5">
                    <input type="text" id="bk-vehicle" placeholder="WP ABC-1234" class="w-full bg-black/50 border-2 border-gray-700 p-4 text-white rounded-xl focus:border-[#00f3ff] outline-none font-bold uppercase">
                    <input type="text" id="bk-name" placeholder="Your Name" class="w-full bg-black/50 border-2 border-gray-700 p-4 text-white rounded-xl focus:border-[#00f3ff] outline-none">
                    <input type="text" id="bk-phone" placeholder="077 123 4567" class="w-full bg-black/50 border-2 border-gray-700 p-4 text-white rounded-xl focus:border-[#00f3ff] outline-none">
                    <select id="bk-service" class="w-full bg-black/50 border-2 border-gray-700 p-4 text-white rounded-xl focus:border-[#00f3ff] outline-none">
                        <option value="General Service">General Service</option>
                        <option value="Hybrid Repair">Hybrid Repair</option>
                        <option value="Engine Issue">Engine Issue</option>
                        <option value="Scan Only">Full System Scan</option>
                    </select>
                    <button onclick="submitBooking()" id="bk-btn" class="w-full bg-gradient-to-r from-[#00f3ff] to-blue-600 hover:from-white hover:to-white hover:text-black text-black font-black py-5 uppercase transition-all rounded-xl mt-4 text-lg tracking-widest shadow-lg">CONFIRM BOOKING</button>
                    <div id="bk-msg" class="hidden text-center text-sm font-bold mt-4 p-3 rounded-lg"></div>
                </div>
            </div>
        </div>
    </section>

    <footer id="contact" class="bg-[#050505] pt-20 pb-10 text-center border-t border-gray-900 relative overflow-hidden">
        <div class="absolute inset-0 opacity-5 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
        <div class="container mx-auto relative z-10">
            <h2 class="text-3xl font-orbitron font-bold text-white mb-2 tracking-wider">WEERASINGHE ENTERPRISE</h2>
            <p class="text-gray-500 text-xs tracking-[0.5em] uppercase mb-10 font-bold">Advanced Automotive Engineering</p>
            <p class="text-gray-700 text-xs uppercase tracking-widest">© 2026 Weerasinghe Enterprise.</p>
        </div>
    </footer>

    <script>
        // *** මෙතනට ඔයාගේ අලුත් LINK එක දාන්න ***
        const API_URL = "https://script.google.com/macros/s/AKfycby5xgqx1-RukHKQh9pfNEYmRp8tu-IS8lIYKHOkd4vhEf4jfvb2d1RausB3rG124d0/exec";

        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const search = params.get('search');
            if(search) {
                document.getElementById('vehicle-input').value = search;
                checkHistory();
                setTimeout(() => { document.getElementById('track').scrollIntoView({behavior: 'smooth', block: 'start'}); }, 500);
            }
            gsap.registerPlugin(ScrollTrigger);
            gsap.from(".service-hex", { scrollTrigger: { trigger: "#services", start: "top 80%" }, y: 80, opacity: 0, stagger: 0.2, duration: 1 });
        }

        async function checkHistory() {
            const vNo = document.getElementById('vehicle-input').value;
            const resArea = document.getElementById('result-area');
            const btn = document.querySelector('#track button');

            if(!vNo) return alert("Enter Vehicle Number!");
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';
            resArea.classList.remove('hidden');
            resArea.style.opacity = "0.5";

            try {
                const res = await fetch(`${API_URL}?vehicle=${vNo}`);
                const data = await res.json();

                if(data.found) {
                    const latest = data.records[0];
                    const past = data.records.slice(1);

                    document.getElementById('r-vno').innerText = vNo.toUpperCase();
                    document.getElementById('r-owner').innerText = latest.owner;
                    document.getElementById('r-service').innerText = latest.service;
                    document.getElementById('r-notes').innerText = latest.notes || "No notes.";
                    document.getElementById('r-date').innerText = "Last Updated: " + latest.date;

                    const st = document.getElementById('r-status');
                    st.innerText = latest.status;
                    if(latest.status === 'DONE') st.className = "bg-green-500 text-white px-4 py-2 text-sm font-black rounded-lg transform -rotate-2 border-2 border-green-700";
                    else if(latest.status === 'ONGOING') st.className = "bg-blue-500 text-white px-4 py-2 text-sm font-black rounded-lg transform -rotate-2 border-2 border-blue-700 animate-pulse";
                    else st.className = "bg-yellow-400 text-black px-4 py-2 text-sm font-black rounded-lg transform -rotate-2 border-2 border-black";

                    // *** NEW QR CODE GENERATION (Local) ***
                    document.getElementById('qr-code').innerHTML = ""; // Clear old
                    const currentUrl = window.location.href.split('?')[0];
                    const qrLink = `${currentUrl}?search=${vNo.replace(/\s/g, '')}`;
                    
                    new QRCode(document.getElementById("qr-code"), {
                        text: qrLink,
                        width: 80,
                        height: 80,
                        colorDark : "#000000",
                        colorLight : "#ffffff",
                        correctLevel : QRCode.CorrectLevel.H
                    });

                    // History
                    const hList = document.getElementById('history-list');
                    if(past.length > 0) {
                        hList.innerHTML = past.map(j => `
                            <div class="flex justify-between items-center border-b border-gray-200 pb-3 border-dashed">
                                <div><p class="font-bold text-black text-base">${j.service}</p><p class="text-xs text-gray-500">${j.date}</p></div>
                                <span class="text-xs font-bold bg-gray-200 text-gray-700 px-3 py-1 rounded-full">${j.status}</span>
                            </div>`).join('');
                    } else { hList.innerHTML = "<p class='italic text-gray-400 text-center py-4'>No previous history.</p>"; }
                    
                    resArea.style.opacity = "1";
                    resArea.scrollIntoView({behavior: 'smooth', block: 'center'});

                } else {
                    alert("Vehicle Not Found in Database!");
                    resArea.classList.add('hidden');
                }
            } catch (e) { 
                console.error(e); 
                alert("Connection Error. Check internet.");
                resArea.classList.add('hidden');
            }
            btn.innerHTML = '<i class="fa-solid fa-arrow-right"></i>';
        }

        async function submitBooking() {
            const vNo = document.getElementById('bk-vehicle').value;
            const name = document.getElementById('bk-name').value;
            const phone = document.getElementById('bk-phone').value;
            const service = document.getElementById('bk-service').value;
            const btn = document.getElementById('bk-btn');
            const msg = document.getElementById('bk-msg');

            if(!vNo || !name || !phone) return alert("Fill all fields!");
            btn.innerText = "SENDING..."; btn.disabled = true;

            try {
                await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ vehicle: vNo, owner: name, service: service, status: "REQUESTED", notes: "Phone: " + phone })
                });
                msg.innerHTML = "BOOKING REQUEST SENT!";
                msg.className = "block bg-green-500/20 text-green-400 border border-green-500/30 p-3 rounded mt-4";
            } catch (e) {
                msg.innerText = "Error sending request.";
            }
            btn.innerText = "CONFIRM BOOKING"; btn.disabled = false;
        }

        function downloadPDF() {
            const element = document.getElementById('report-card');
            const vNo = document.getElementById('vehicle-input').value || "Report";
            
            // Generate PDF
            const opt = {
                margin: 0.5,
                filename: `WeerasingheAuto_${vNo}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true }, // CORS enabled
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            
            const btn = document.querySelector('#result-area button');
            const oldText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Generating PDF...';
            
            // Wait 500ms for QR code to fully render inside canvas
            setTimeout(() => {
                html2pdf().set(opt).from(element).save().then(() => {
                    btn.innerHTML = oldText;
                });
            }, 500);
        }
    </script>
</body>
</html>
